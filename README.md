# CommuCat Server üêæ

[![CI](https://github.com/ducheved/commucat/actions/workflows/ci.yml/badge.svg)](https://github.com/ducheved/commucat/actions/workflows/ci.yml)
[![Release](https://github.com/ducheved/commucat/actions/workflows/release.yml/badge.svg)](https://github.com/ducheved/commucat/actions/workflows/release.yml)
[![Deploy](https://github.com/ducheved/commucat/actions/workflows/deploy.yml/badge.svg)](https://github.com/ducheved/commucat/actions/workflows/deploy.yml)
[![License: MPL-2.0](https://img.shields.io/badge/License-MPL--2.0-orange.svg)](LICENSE)
[![Website](https://img.shields.io/badge/commucat.tech-live-blue?logo=firefox)](https://commucat.tech)

> **NOTE:** –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∏–∂–µ –æ—Ç—Ä–∞–∂–∞—é—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è. –í—Å—ë, —á—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ TODO, –µ—â—ë –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ.

---

## üá∑üá∫ –û–±–∑–æ—Ä

CommuCat ‚Äî —Å–µ—Ä–≤–µ—Ä –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π. –ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã:
- –≤—Ö–æ–¥—è—â–∏–π HTTP/2-—Ç—É–Ω–Ω–µ–ª—å –Ω–∞ Pingora —Å Noise XK/IK (`crates/server::app::process_connect`);
- —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤, friends-list –∏ REST API –¥–ª—è pairing (`/api/pair`, `/api/friends`);
- –æ—Ñ–ª–∞–π–Ω-–¥–æ—Å—Ç–∞–≤–∫–∞ —á–µ—Ä–µ–∑ PostgreSQL/Redis (`relay_queue`, presence, session tokens);
- –ø—Ä–∏—ë–º RAW PCM/I420 —Å –ø–µ—Ä–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤ Opus/VP8 –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏ —Ä–µ—Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–∞–¥—Ä–æ–≤ (—Å–µ—Ä–≤–µ—Ä –æ—Å—Ç–∞—ë—Ç—Å—è SFU, –±–µ–∑ –º–∏–∫—à–∏—Ä–æ–≤–∞–Ω–∏—è);
- P2P assist, –≤—ã–¥–∞—é—â–∏–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –º—É–ª—å—Ç–∏–ø—É—Ç—è–º –∏ PQ-–∫–ª—é—á–∞–º.

### –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

| Crate | –†–æ–ª—å | –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ |
|-------|------|-------------------|
| `crates/server` | HTTP/2 —Ç—É–Ω–Ω–µ–ª—å, REST, pass-through SFU | **–†–∞–±–æ—Ç–∞–µ—Ç**: –ø—Ä–∏–Ω–∏–º–∞–µ—Ç/–ø–µ—Ä–µ–∫–æ–¥–∏—Ä—É–µ—Ç RAW‚ÜíOpus/VP8, –≤–µ–¥—ë—Ç state –≤—ã–∑–æ–≤–æ–≤; –º–∏–∫—à–∏—Ä–æ–≤–∞–Ω–∏—è, –æ–±—Ñ—É—Å–∫–∞—Ü–∏–∏ –∏ PQ-–≥–∏–±—Ä–∏–¥–∞ –≤—Å—ë –µ—â—ë –Ω–µ—Ç.
| `crates/proto` | –§–æ—Ä–º–∞—Ç—ã CCP-1, —Å–∏–≥–Ω–∞–ª—å–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, obf scaffolding | **–†–∞–±–æ—Ç–∞–µ—Ç** –¥–ª—è –±–∞–∑–æ–≤–æ–≥–æ —Ñ—Ä–µ–π–º–∏–Ω–≥–∞; capability –ø–æ–ª—è –¥–ª—è –º–µ–¥–∏–∞/obf –∑–∞–≤–µ–¥–µ–Ω—ã, –Ω–æ —Å–µ—Ä–≤–µ—Ä –∏—Ö –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç.
| `crates/media` | –ß–µ—Ä–Ω–æ–≤—ã–µ –∞—É–¥–∏–æ/–≤–∏–¥–µ–æ –∫–æ–¥–µ–∫–∏ –∏ –ø–∞–π–ø–ª–∞–π–Ω—ã | **–†–∞–±–æ—Ç–∞–µ—Ç (Opus/VP8)**: —Å–µ—Ä–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–ª—è –ø–µ—Ä–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è RAW; AV1/H264/GPU –æ—Å—Ç–∞—é—Ç—Å—è –∑–∞–≥–ª—É—à–∫–∞–º–∏.
| `crates/media-types` | –û–±—â–∏–µ –æ–ø–∏—Å–∞—Ç–µ–ª–∏ –∫–æ–¥–µ–∫–æ–≤ | **–†–∞–±–æ—Ç–∞–µ—Ç** –∫–∞–∫ –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö; –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç—Å—è `proto`/`media`.
| `crates/crypto` | Noise, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã, PQ-—Ö–µ–ª–ø–µ—Ä—ã | **–†–∞–±–æ—Ç–∞–µ—Ç** –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ö–µ–º—ã; PQ-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ `/api/p2p/assist`.
| `crates/storage` | Postgres/Redis –¥–æ—Å—Ç—É–ø | **–†–∞–±–æ—Ç–∞–µ—Ç**: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–æ–º.
| `crates/federation` | –ü–æ–¥–ø–∏—Å–∏ –¥–ª—è –º–µ–∂–¥–æ–º–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π | **–†–∞–±–æ—Ç–∞–µ—Ç**, –Ω–æ —Ñ–µ–¥–µ—Ä–∞—Ü–∏—è –µ—â—ë –Ω–µ –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω–∞ –≤ –ø—Ä–æ–¥–µ.
| `crates/ledger` | –ê—É–¥–∏—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤ | **–†–∞–±–æ—Ç–∞–µ—Ç**, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–æ–º.
| `crates/cli` | –ú–∏–≥—Ä–∞—Ü–∏–∏, —Ä–æ—Ç–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤ | **–†–∞–±–æ—Ç–∞–µ—Ç**, –ø–æ–∫—Ä—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Ä—É—á–Ω—É—é —Ä–æ—Ç–∞—Ü–∏—é.

### –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è –∏ —Ç—Ä–∞—Ñ–∏–∫
- Noise `XK`/`IK` (ChaCha20-Poly1305 + BLAKE2s) —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º prologue ‚Äî `crates/crypto::build_handshake`.
- –ü–æ—Å—Ç-–∫–≤–∞–Ω—Ç–æ–≤—ã–µ –ø—Ä–∏–º–∏—Ç–∏–≤—ã –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è P2P assist (`build_pq_advice`), –Ω–æ **–Ω–µ –≤—Å—Ç—Ä–æ–µ–Ω—ã** –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç—É–Ω–Ω–µ–ª—å.
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è Noise static –∫–ª—é—á–µ–π –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞, —Å –≥—Ä–∞—Ü–∏–æ–∑–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π.
- Rate limiting –¥–ª—è `/connect`, REST API –∏ –∑–∞—è–≤–æ–∫ –Ω–∞ pairing-–∫–æ–¥—ã –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç DoS.
- RaptorQ –∏ MultipathTunnel –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Å–æ–≤–µ—Ç–æ–≤ –≤ `/api/p2p/assist`, –∞ –Ω–µ –¥–ª—è –±–æ–µ–≤–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞.
- –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –æ–±—Ñ—É—Å–∫–∞—Ü–∏—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –∫–∞–∫ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ (`proto/obfuscation`), —Å–µ—Ä–≤–µ—Ä –µ—ë –Ω–µ –∑–∞–¥–µ–π—Å—Ç–≤—É–µ—Ç.

### –ú–µ–¥–∏–∞ –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞ (—Å—Ç–∞—Ç—É—Å)
- –°–µ—Ä–≤–µ—Ä —É–º–µ–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å RAW PCM/I420 –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤, –ø–µ—Ä–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –≤ Opus/VP8 –∏ –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∞–¥—Ä—ã; –º–∏–∫—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –Ω–µ—Ç.
- `crates/media` —Ç–µ–ø–µ—Ä—å –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–ª—è Opus/VP8. –§–∏—á–∏ `codec-h264`/`codec-av1`, GPU-—É—Å–∫–æ—Ä–µ–Ω–∏–µ –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –±–∏—Ç—Ä–µ–π—Ç –≤—Å—ë –µ—â—ë –∑–∞–≥–ª—É—à–∫–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `MediaError::Unsupported`.
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `available_codecs`, `MediaSourceMode::Raw/Encoded` –∏ capability negotiation —Å–µ—Ä–∏–∞–ª–∏–∑—É—é—Ç—Å—è –≤ `CALL_*`, –Ω–æ —Å–µ—Ä–≤–µ—Ä –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Ñ–∏–ª—å Opus/VP8 –∏ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã.
- –ó–∞—Ö–≤–∞—Ç –∞—É–¥–∏–æ (`audio-io`) –∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ ¬´pipelines¬ª –æ—Å—Ç–∞—é—Ç—Å—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏; –∫–æ–Ω–µ—á–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã —Å–∞–º–∏ –ø–æ—Å—Ç–∞–≤–ª—è—Ç—å PCM/I420 –∏–ª–∏ –≥–æ—Ç–æ–≤—ã–µ –∫–∞–¥—Ä—ã.
- FEC/SVC/–º—É–ª—å—Ç–∏–ø—É—Ç—å –¥–ª—è –º–µ–¥–∏–∞ –∏ GPU-—Ö—ç–Ω–¥–ª–µ—Ä—ã –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –≤ TODO (—Å–º. PROTOCOL.md).

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
| –ú–æ–¥—É–ª—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ |
|--------|------------|------------|
| `crates/server` | HTTP/2 —Ç—É–Ω–Ω–µ–ª—å, REST API, presence, —Ä–µ—Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è | `pingora`, `tokio`, `tracing`, `commucat-*` |
| `crates/proto` | –ö–æ–¥–µ–∫–∏ CCP-1, —á–µ—Ä–Ω–æ–≤–∏–∫ –æ–±—Ñ—É—Å–∫–∞—Ç–æ—Ä–∞ | `serde`, `serde_json`, `rand` (–æ–ø—Ü.) |
| `crates/crypto` | Noise, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã, PQ-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è P2P assist | `snow`, `blake3`, `ml-kem`, `ml-dsa` |
| `crates/storage` | PostgreSQL + Redis | `tokio-postgres`, `redis`, `serde` |
| `crates/federation` | –ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π —Ñ–µ–¥–µ—Ä–∞—Ü–∏–∏ | `ed25519-dalek`, `serde` |
| `crates/ledger` | –ê—É–¥–∏—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤ | `serde`, `chrono` |
| `crates/cli` | –ú–∏–≥—Ä–∞—Ü–∏–∏, –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ | `commucat-storage`, `tokio` |

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞
1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.sample` ‚Üí `.env`, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ Postgres/Redis/TLS/federation.
2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `commucat.toml` (–≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã —É–∂–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã –≤ —à–∞–±–ª–æ–Ω–µ).
3. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ Noise static key –∏ federation seed (`commucat-cli rotate-keys`).
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ `commucat-cli migrate`, –∑–∞—Ç–µ–º `commucat-server --config commucat.toml`.

### –ü—Ä–æ–≤–µ—Ä–∫–∞
```bash
cargo fmt --all
cargo clippy --workspace --all-targets -- -D warnings
cargo test --workspace --all-features
```
–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç: –∫–æ–¥–µ–∫ CCP-1, Noise, —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (`crates/*/tests`).

---

## TODO / Planned
- **Post-quantum –≥–∏–±—Ä–∏–¥ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ç—É–Ω–Ω–µ–ª–µ.** –°–µ–π—á–∞—Å ML-KEM/ML-DSA –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Å–æ–≤–µ—Ç–∞—Ö P2P. –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞—Å—à–∏—Ä–∏—Ç—å `process_handshake_frame`, –≤–Ω–µ–¥—Ä–∏—Ç—å negotiation `HELLO.capabilities` –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `HybridRatchet` –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–µ—Å—Å–∏–∏.
- **–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ pluggable transports.** –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `Reality`, `AmnesiaWG`, `Shadowsocks`, `Onion` ‚Äî –∑–∞–≥–ª—É—à–∫–∏ –Ω–∞ `tokio::io::duplex`. –ù—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –≤ –º–µ–¥–∏–∞/—Å–æ–æ–±—â–µ–Ω–∏—è.
- **–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –æ–±—Ñ—É—Å–∫–∞—Ü–∏—è.** –í–∫–ª—é—á–∏—Ç—å `proto/obfuscation` –≤ —Å–µ—Ä–≤–µ—Ä–Ω—ã–π pipeline: –ø—Ä–∏–Ω–∏–º–∞—Ç—å/–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å `ObfuscatedPacket`, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á–∏ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏.
- **–ú–µ–¥–∏–∞-–ø–∞–π–ø–ª–∞–π–Ω.** –†–∞—Å—à–∏—Ä–∏—Ç—å Opus/VP8-—Ç—Ä–∞–Ω—Å–∫–æ–¥–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π H.264/AV1, GPU-—É—Å–∫–æ—Ä–µ–Ω–∏—è, –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –±–∏—Ç—Ä–µ–π—Ç–∞ –∏ e2e-—Ç–µ—Å—Ç–æ–≤; –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å capability negotiation –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π.
- **RaptorQ multipath –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π.** –°–µ–π—á–∞—Å FEC —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ª–∏—à—å –≤ `/api/p2p/assist`. –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å `MultipathTunnel` –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É —Ç—Ä–∞—Ñ–∏–∫—É –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø—É—Ç—è–º.
